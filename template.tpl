___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Yahoo広告（ディスプレイ広告） - コンバージョン測定タグ",
  "description": "Yahoo広告（ディスプレイ広告）のコンバージョン測定用タグです。",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "displayName": "",
    "id": "brand_dummy",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "displayName": "\u003ca href\u003d\"https://ads-help.yahoo.co.jp/yahooads/display/articledetail?lan\u003dja\u0026aid\u003d59417\"\u003eコンバージョン測定（ディスプレイ広告）\u003c/a\u003e",
    "name": "product_link",
    "type": "LABEL"
  },
  {
    "help": "アカウントを識別するためのIDです。コンバージョン測定タグに記載されているアカウントIDを入力してください。",
    "displayName": "yahoo_ydn_conv_io",
    "simpleValueType": true,
    "name": "yahoo_ydn_conv_io",
    "type": "TEXT"
  },
  {
    "help": "コンバージョンラベルを識別するためのIDです。コンバージョン測定タグに記載されているラベルIDを入力してください。既存のタグはIDを発行されませんので、この項目は空となります。",
    "displayName": "yahoo_ydn_conv_label",
    "simpleValueType": true,
    "name": "yahoo_ydn_conv_label",
    "type": "TEXT",
    "canBeEmptyString": true
  },
  {
    "help": "動的にユニークな取引管理番号を発行している場合はその値をセットすることで取引完了ページを複数回リロードした際の重複カウントを正確に排除できます。",
    "displayName": "yahoo_ydn_conv_transaction_id",
    "simpleValueType": true,
    "name": "yahoo_ydn_conv_transaction_id",
    "type": "TEXT",
    "canBeEmptyString": true
  },
  {
    "help": "コンバージョンタグごとに設定する「コンバージョンの価値」です。",
    "displayName": "yahoo_ydn_conv_value",
    "simpleValueType": true,
    "name": "yahoo_ydn_conv_value",
    "type": "TEXT",
    "canBeEmptyString": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
log('data =', data);

const query = require('queryPermission');
const createArgumentsQueue = require('createArgumentsQueue');
const injectScript = require('injectScript');
const url = 'https://s.yimg.jp/images/listing/tool/cv/ytag.js';

const onSuccess = () => {
  log('Conductrics: Script loaded successfully.');  
  
  let ytag = createArgumentsQueue('ytag', 'yjDataLayer');
  ytag({
    type: 'yjad_conversion',
        config: {
          yahoo_ydn_conv_io: data.yahoo_ydn_conv_io,
          yahoo_ydn_conv_label: data.yahoo_ydn_conv_label,
          yahoo_ydn_conv_transaction_id: data.yahoo_ydn_conv_transaction_id,
          yahoo_ydn_conv_value: data.yahoo_ydn_conv_value
        }}
      );
  
  data.gtmOnSuccess();
};

const onFailure = () => {
  log('Conductrics: Script load failed.');
  data.gtmOnFailure();
};

if (query('inject_script', url)) injectScript(url, onSuccess, onFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ytag"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "yjDataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://s.yimg.jp/images/listing/tool/cv/ytag.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 2020/3/18 11:36:38


